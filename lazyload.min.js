// IntersectionObserver-based lazy loader
document.addEventListener('DOMContentLoaded',()=>{
    const imgs = document.querySelectorAll('img[loading="lazy"],picture[data-lazy]');
    const obs = new IntersectionObserver((ents,ob)=>{
      ents.forEach(e=>{
        if(e.isIntersecting){
          const el=e.target;
          if(el.tagName==='IMG'){
            el.src=el.dataset.src||el.src;
            el.removeAttribute('loading');
          } else if(el.tagName==='PICTURE'){
            el.querySelectorAll('source').forEach(s=>s.srcset=s.dataset.srcset);
            el.querySelector('img').src=el.querySelector('img').dataset.src;
          }
          ob.unobserve(el);
        }
      });
    },{rootMargin:'100px'});
    imgs.forEach(i=>obs.observe(i));
  });
  